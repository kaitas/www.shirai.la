<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://blog.shirai.la/tsuda/xmlrpc.php">

<title>Kinect Unityで人物のみ抽出する方法 &#8211; 汗を流して飯が旨い</title>
<link rel='dns-prefetch' href='//fonts.googleapis.com/' />
<link rel="alternate" type="application/rss+xml" title="汗を流して飯が旨い &raquo; フィード" href="feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="汗を流して飯が旨い &raquo; コメントフィード" href="comments/feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/blog.shirai.la\/tsuda\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.6"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='jquery.bxslider-css'  href='wp-content/plugins/bxslider-integration/assets/css/bxslider-integration.min.css@ver=5.1.6.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='wp-includes/css/dist/block-library/style.min.css@ver=5.1.6.css' type='text/css' media='all' />
<link rel='stylesheet' id='bp-member-block-css'  href='wp-content/plugins/buddypress/bp-members/css/blocks/member.min.css@ver=6.0.0.css' type='text/css' media='all' />
<link rel='stylesheet' id='bp-group-block-css'  href='wp-content/plugins/buddypress/bp-groups/css/blocks/group.min.css@ver=6.0.0.css' type='text/css' media='all' />
<link rel='stylesheet' id='bp-legacy-css-css'  href='wp-content/plugins/buddypress/bp-templates/bp-legacy/css/buddypress.min.css@ver=6.0.0.css' type='text/css' media='screen' />
<link rel='stylesheet' id='contact-form-7-css'  href='wp-content/plugins/contact-form-7/includes/css/styles.css@ver=5.1.9.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpt-twitter-feed-css'  href='wp-content/plugins/wp-to-twitter/css/twitter-feed.css@ver=5.1.6.css' type='text/css' media='all' />
<link rel='stylesheet' id='dlm-frontend-css'  href='wp-content/plugins/download-monitor/assets/css/frontend.css@ver=5.1.6.css' type='text/css' media='all' />
<link rel='stylesheet' id='pictorico-style-css'  href='wp-content/themes/pictorico/style.css@ver=5.1.6.css' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='wp-content/themes/pictorico/genericons/genericons.css@ver=3.0.3.css' type='text/css' media='all' />
<link rel='stylesheet' id='pictorico-open-sans-condensed-css'  href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed%3A300%2C300italic%2C700&#038;subset=latin%2Clatin-ext&#038;ver=5.1.6' type='text/css' media='all' />
<link rel='stylesheet' id='pictorico-pt-serif-css'  href='https://fonts.googleapis.com/css?family=PT+Serif%3A400%2C700%2C400italic%2C700italic&#038;ver=5.1.6' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='wp-includes/css/dashicons.min.css@ver=5.1.6.css' type='text/css' media='all' />
<link rel='stylesheet' id='thickbox-css'  href='wp-includes/js/thickbox/thickbox.css@ver=5.1.6.css' type='text/css' media='all' />
<link rel='stylesheet' id='amazonjs-css'  href='wp-content/plugins/amazonjs/css/amazonjs.css@ver=0.10.css' type='text/css' media='all' />
<link rel='stylesheet' id='amazonjs-custom-css'  href='http://blog.shirai.la/tsuda/wp-content/themes/pictorico/amazonjs.css?ver=5.1.6' type='text/css' media='all' />
<script type='text/javascript' src='wp-includes/js/jquery/jquery.js@ver=1.12.4'></script>
<script type='text/javascript' src='wp-includes/js/jquery/jquery-migrate.min.js@ver=1.4.1'></script>
<script type='text/javascript' src='wp-content/plugins/bxslider-integration/assets/js/bxslider-integration.min.js@ver=5.1.6'></script>
<script type='text/javascript' src='wp-content/plugins/buddypress/bp-core/js/confirm.min.js@ver=6.0.0'></script>
<script type='text/javascript' src='wp-content/plugins/buddypress/bp-core/js/widget-members.min.js@ver=6.0.0'></script>
<script type='text/javascript' src='wp-content/plugins/buddypress/bp-core/js/jquery-query.min.js@ver=6.0.0'></script>
<script type='text/javascript' src='wp-content/plugins/buddypress/bp-core/js/vendor/jquery-cookie.min.js@ver=6.0.0'></script>
<script type='text/javascript' src='wp-content/plugins/buddypress/bp-core/js/vendor/jquery-scroll-to.min.js@ver=6.0.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var BP_DTheme = {"accepted":"\u627f\u8a8d\u6e08","close":"\u9589\u3058\u308b","comments":"\u30b3\u30e1\u30f3\u30c8","leave_group_confirm":"\u672c\u5f53\u306b\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u96e2\u8131\u3057\u307e\u3059\u304b ?","mark_as_fav":"\u304a\u6c17\u306b\u5165\u308a","my_favs":"\u308f\u305f\u3057\u306e\u304a\u6c17\u306b\u5165\u308a","rejected":"\u62d2\u5426\u6e08\u307f","remove_fav":"\u304a\u6c17\u306b\u5165\u308a\u304b\u3089\u524a\u9664","show_all":"\u3059\u3079\u3066\u8868\u793a","show_all_comments":"\u3053\u306e\u30b9\u30ec\u30c3\u30c9\u306e\u3059\u3079\u3066\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u898b\u308b","show_x_comments":"\u3059\u3079\u3066\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u8868\u793a  (%d)","unsaved_changes":"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u5909\u66f4\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3059\u308b\u3068\u3001\u5909\u66f4\u304c\u3059\u3079\u3066\u5931\u308f\u308c\u307e\u3059\u3002","view":"\u8868\u793a","store_filter_settings":""};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content/plugins/buddypress/bp-templates/bp-legacy/js/buddypress.min.js@ver=6.0.0'></script>
<link rel='https://api.w.org/' href='http://blog.shirai.la/tsuda/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php@rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Lavalvirtual' href='index.html@p=284.html' />
<link rel='next' title='choregrapheを使ってPepper開発してみる-開発環境構築編' href='http://blog.shirai.la/tsuda/2015/02/08/choregraphe%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6pepper%e9%96%8b%e7%99%ba%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b-%e9%96%8b%e7%99%ba%e7%92%b0%e5%a2%83%e6%a7%8b%e7%af%89%e7%b7%a8/' />
<meta name="generator" content="WordPress 5.1.6" />
<link rel="canonical" href="index.html@p=286.html" />
<link rel='shortlink' href='index.html@p=286.html' />
<link rel="alternate" type="application/json+oembed" href="http://blog.shirai.la/tsuda/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.shirai.la%2Ftsuda%2F2015%2F02%2F07%2Fkinect-unity%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://blog.shirai.la/tsuda/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.shirai.la%2Ftsuda%2F2015%2F02%2F07%2Fkinect-unity%2F&#038;format=xml" />

	<script type="text/javascript">var ajaxurl = 'http://blog.shirai.la/tsuda/wp-admin/admin-ajax.php';</script>

		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<script type="text/javascript" src="http://blog.shirai.la/tsuda/wp-content/plugins/si-captcha-for-wordpress/captcha/si_captcha.js?ver=1592159161"></script>
<!-- begin SI CAPTCHA Anti-Spam - login/register form style -->
<style type="text/css">
.si_captcha_small { width:175px; height:45px; padding-top:10px; padding-bottom:10px; }
.si_captcha_large { width:250px; height:60px; padding-top:10px; padding-bottom:10px; }
img#si_image_com { border-style:none; margin:0; padding-right:5px; float:left; }
img#si_image_reg { border-style:none; margin:0; padding-right:5px; float:left; }
img#si_image_log { border-style:none; margin:0; padding-right:5px; float:left; }
img#si_image_side_login { border-style:none; margin:0; padding-right:5px; float:left; }
img#si_image_checkout { border-style:none; margin:0; padding-right:5px; float:left; }
img#si_image_jetpack { border-style:none; margin:0; padding-right:5px; float:left; }
img#si_image_bbpress_topic { border-style:none; margin:0; padding-right:5px; float:left; }
.si_captcha_refresh { border-style:none; margin:0; vertical-align:bottom; }
div#si_captcha_input { display:block; padding-top:15px; padding-bottom:5px; }
label#si_captcha_code_label { margin:0; }
input#si_captcha_code_input { width:65px; }
p#si_captcha_code_p { clear: left; padding-top:10px; }
.si-captcha-jetpack-error { color:#DC3232; }
</style>
<!-- end SI CAPTCHA Anti-Spam - login/register form style -->
	<style type="text/css">
			.site-title a,
		.site-description {
			color: #000000;
		}
		</style>
	<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #ffffff; background-image: url("files/2016/01/diamonds-582603_960_720-2.jpg"); background-position: center top; background-size: auto; background-repeat: repeat; background-attachment: scroll; }
</style>
	</head>

<body class="bp-legacy post-template-default single single-post postid-286 single-format-standard custom-background no-js">
<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">
		<div class="site-header-inner">
			<div class="site-branding">
				<h1 class="site-title"><a href="../tsuda.1.html" rel="home">汗を流して飯が旨い</a></h1>
				<h2 class="site-description">飯とか技術とかイベントとか</h2>
			</div>
			<nav id="site-navigation" class="main-navigation" role="navigation">
				<h1 class="menu-toggle"><span class="screen-reader-text">メニュー</span></h1>
				<a class="skip-link screen-reader-text" href="index.html@p=286.html#content">コンテンツへスキップ</a>

				<div class="menu-elbee-elgee-buddypress-menu-container"><ul id="menu-elbee-elgee-buddypress-menu" class="menu"><li id="menu-item-568" class="home menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-568"><a href="../tsuda.1.html">ホーム</a></li>
<li id="menu-item-579" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-579"><a href="index.html@p=246.html">このブログについて</a></li>
<li id="menu-item-581" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-581"><a href="index.html@p=5.html">プロフィール</a></li>
<li id="menu-item-573" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-573"><a href="index.html@p=365.html">制作作品一覧</a>
<ul class="sub-menu">
	<li id="menu-item-578" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-578"><a href="index.html@p=31.html">学内制作作品</a></li>
	<li id="menu-item-576" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-576"><a href="index.html@p=161.html">自主制作作品</a></li>
	<li id="menu-item-577" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-577"><a href="index.html@p=133.html">ゲームジャム</a></li>
	<li id="menu-item-574" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-574"><a href="http://blog.shirai.la/tsuda/all/%e3%83%8f%e3%83%83%e3%82%ab%e3%82%bd%e3%83%b3/">ハッカソン</a></li>
	<li id="menu-item-575" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-575"><a href="index.html@p=163.html">はげピッ!ピッ!</a></li>
</ul>
</li>
<li id="menu-item-835" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-835"><a href="index.html@p=36.html">趣味</a></li>
<li id="menu-item-985" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-985"><a href="index.html@p=983.html">Publications</a></li>
<li id="menu-item-1039" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1039"><a href="index.html@p=1036.html">ブログお引っ越し</a></li>
<li id="menu-item-1064" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1064"><a href="http://blog.shirai.la/tsuda/%e3%82%a2%e3%82%af%e3%82%bb%e3%82%b9%e3%81%aa%e3%81%97/">アクセスなし</a></li>
</ul></div>			</nav><!-- #site-navigation -->
			<div class="header-search">
				<form role="search" method="get" class="search-form" action="../tsuda.1.html">
				<label>
					<span class="screen-reader-text">検索:</span>
					<input type="search" class="search-field" placeholder="検索 &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="検索" />
			</form>			</div>
		</div>
	</header><!-- #masthead -->
		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<article id="post-286" class="has-thumbnail post-286 post type-post status-publish format-standard has-post-thumbnail hentry category-kinect category-unity category-3 tag-kinect tag-unity tag-45">

	<header class="entry-header">
									<div class="entry-thumbnail" style="background-image: url(files/2015/02/kinect1-e1430448380229.png);"></div>
							<h1 class="entry-title">Kinect Unityで人物のみ抽出する方法</h1>
	</header><!-- .entry-header -->
	<div class="entry-meta">
				<span class="posted-on"><a href="index.html@p=286.html" rel="bookmark"><time class="entry-date published" datetime="2015-02-07T19:44:13+09:00">2015年2月7日</time><time class="updated" datetime="2015-09-18T11:54:48+09:00">2015年9月18日</time></a></span><span class="byline"><span class="sep"> &bull; </span><span class="author vcard"><a class="url fn n" href="author/tsuda/index.html">Ryotaro Tsuda</a></span></span>	</div><!-- .entry-meta -->
	<div class="entry-content">
		<p>Unityを利用してkinectから人物のみを切り出す方法をまとめます。ネットで調べたところXNA版とWPF版は多く存在しましたが、Unityでの方法は見つからなかったので。</p>
<p><a href="files/2015/02/kinect1.png"><img class="alignnone size-medium wp-image-287" src="files/2015/02/kinect1-255x300.png" alt="kinect1" width="255" height="300" /></a></p>
<p>&nbsp;</p>
<p>まず初めに開発環境です</p>
<p>Windows8.1 Enterprise 64bit</p>
<p>Unity Pro 4.6.1f</p>
<p><a href="http://wiki.etc.cmu.edu/unity3d/index.php/Microsoft_Kinect_-_Microsoft_SDK#Kinect" target="_blank">wrapper to Kinect SDK 1.7 </a></p>
<p>&nbsp;</p>
<p>wrapperPackageをインストールするとAssets&gt;Script&gt;Kinect&gt;KinectImgControllersの中にDisplayColor.csとDisplayDepth.csが作られます。</p>
<p>このスクリプトをオブジェクトにアタッチすると、DisplayColorからはRGB画像が、DisplayDepthからはDepth画像がテクスチャとしてオブジェクトに貼られます。</p>
<p>DisplayDepth.csの中を見てみると、Update()の中にコメントアウトされた</p>
<p><em><strong>tex.SetPixels32(convertPlayersToCutout(dw.segmentations));</strong></em></p>
<p>があります。これは人がいるところをテクスチャとして吐き出す関数です。それのコメントアウトを外し、tex.SetPixels32(convertDepthToColor(dw.depthImg));をコメントアウトをして無効にします。</p>
<p>またDisplayDepth.csとDisplayColor.csの両方にrenderer.material.mainTexture = tex;の記述があるのでコメントアウトしてください。これがあるとオブジェクトに画像が張られてしまうためです。</p>
<p>これでDisplayDepth.csをアタッチされたオブジェクトにプレイヤー部分のみを抽出するテクスチャが貼り付けられるようになりました。</p>
<p>convertPlayersToCutoutを見てみると人がいるところはアルファチャンネルが255になり、いないところは0になるようです。</p>
<p>今回引数として使用しているdw.segmentationsはDepthWrapper.csから確認するとpixelを一つ一つ確認してプレイヤーがいたらtrueを返すような仕組みになっていおり、playerは6名まで確認することができるようです。</p>
<p>&nbsp;</p>
<p>さて、これでRGB画像と人物情報を持った画像を生成することができました。</p>
<p>次に適当な背景画像を用意します。</p>
<p>&nbsp;</p>
<p>今回は一つシェーダーを用意し、背景画像、RGB画像、人物画像を三つ重ね、人がいる部分はRGB画像を、人がいない部分は背景画像をといった処理を書いていきたいと思います。</p>
<p>まず実装するために必要なシェーダーMaskingShader.shaderを書きます</p>
<p>&nbsp;</p>
<p style="text-align: center">MaskingShader.shader</p>
<hr />
<p><em><strong>_BackTex (&#8220;Back&#8221;, 2D) = &#8220;white&#8221; {}</strong></em><br />
<em><strong> _MaskTex (&#8220;Mask&#8221;, 2D) = &#8220;white&#8221; {}</strong></em><br />
<em><strong> }</strong></em><br />
<em><strong> SubShader {</strong></em><br />
<em><strong> Tags { &#8220;RenderType&#8221;=&#8221;Opaque&#8221; }</strong></em><br />
<em><strong> LOD 200</strong></em></p>
<p><em><strong> Pass{</strong></em><br />
<em><strong> CGPROGRAM</strong></em><br />
<em><strong> #pragma vertex vert</strong></em><br />
<em><strong> #pragma fragment frag</strong></em><br />
<em><strong> #pragma target 3.0</strong></em></p>
<p><em><strong> //バーテックス用入力</strong></em><br />
<em><strong> struct vertexInput{</strong></em><br />
<em><strong> float4 vertex : POSITION;</strong></em><br />
<em><strong> float2 uv : TEXCOORD0;</strong></em><br />
<em><strong> };</strong></em></p>
<p><em><strong> //フラグメント用入力/バーテックス用出力</strong></em><br />
<em><strong> struct fragmentInput{</strong></em><br />
<em><strong> float4 position : SV_POSITION;</strong></em><br />
<em><strong> float2 uv : TEXCOORD0;</strong></em><br />
<em><strong> };</strong></em></p>
<p><em><strong> sampler2D _MainTex;</strong></em><br />
<em><strong> sampler2D _BackTex;</strong></em><br />
<em><strong> sampler2D _MaskTex;</strong></em></p>
<p><em><strong> fragmentInput vert(vertexInput v){</strong></em><br />
<em><strong> fragmentInput o;</strong></em><br />
<em><strong> o.position = mul(UNITY_MATRIX_MVP, v.vertex);</strong></em><br />
<em><strong> o.uv = v.uv;</strong></em><br />
<em><strong> return o;</strong></em><br />
<em><strong> }</strong></em></p>
<p><em><strong> float4 frag(fragmentInput i) : COLOR{</strong></em><br />
<em><strong> float4 maintex = tex2D(_MainTex, i.uv);</strong></em><br />
<em><strong> float4 backtex = tex2D(_BackTex, i.uv);</strong></em><br />
<em><strong> float4 masktex = tex2D(_MaskTex, i.uv);</strong></em><br />
<em><strong> float4 output;</strong></em></p>
<p><em><strong> if(masktex.a &gt; 0.2f){</strong></em><br />
<em><strong> output.rgb = maintex.rgb;</strong></em><br />
<em><strong> }else{</strong></em><br />
<em><strong> output.rgb = backtex.rgb;</strong></em><br />
<em><strong> }</strong></em></p>
<p><em><strong> return float4(output.r,output.g,output.b,1.0);</strong></em><br />
<em><strong> }</strong></em></p>
<p><em><strong> ENDCG</strong></em><br />
<em><strong> }</strong></em><br />
<em><strong> } </strong></em><br />
<em><strong> FallBack &#8220;Diffuse&#8221;</strong></em><br />
<em><strong>}</strong></em></p>
<hr />
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>3つのテクスチャを格納し、masktexの値でmaintexを出すかbacktexを出すか判断しています。</p>
<p>またこのシェーダーのためのマテリアルMaskmatも用意しておいてください。</p>
<p>&nbsp;</p>
<p>次に、このシェーダーにテクスチャを渡すためのスクリプトMaskScript.csを書きます</p>
<p>&nbsp;</p>
<p style="text-align: center">MaskScript.cs</p>
<hr />
<p><em><strong>using UnityEngine;</strong></em><br />
<em><strong>using System.Collections;</strong></em></p>
<p><em><strong>public class MaskScript : MonoBehaviour {</strong></em><br />
<em><strong> Texture2D color;</strong></em><br />
<em><strong> Texture2D depth;</strong></em><br />
<em><strong> public Texture2D back;</strong></em><br />
<em><strong> public Material Mat;</strong></em><br />
<em><strong> DisplayDepth ddepth;</strong></em><br />
<em><strong> DisplayColor dcolor;</strong></em></p>
<p><em><strong>void Awake(){</strong></em><br />
<em><strong> ddepth = this.GetComponent&lt;DisplayDepth&gt; ();</strong></em><br />
<em><strong> dcolor = this.gameObject.GetComponent&lt;DisplayColor&gt; ();</strong></em><br />
<em><strong> }</strong></em><br />
<em><strong> // Use this for initialization</strong></em><br />
<em><strong> void Start () {</strong></em><br />
<em><strong> Mat.SetTexture (&#8220;_MainTex&#8221;, color);</strong></em><br />
<em><strong> Mat.SetTexture (&#8220;_BackTex&#8221;, back);</strong></em><br />
<em><strong> Mat.SetTexture (&#8220;_MaskTex&#8221;, depth);</strong></em></p>
<p><em style="line-height: 1.5"><strong>}</strong></em></p>
<p><em><strong>// Update is called once per frame</strong></em><br />
<em><strong> void Update () {</strong></em><br />
<em><strong> color = dcolor.tex;</strong></em><br />
<em><strong> depth = ddepth.tex;</strong></em></p>
<p><em><strong>Mat.SetTexture (&#8220;_MainTex&#8221;, color);</strong></em><br />
<em><strong> Mat.SetTexture (&#8220;_BackTex&#8221;, back);</strong></em><br />
<em><strong> Mat.SetTexture (&#8220;_MaskTex&#8221;, depth);</strong></em><br />
<em><strong> }</strong></em></p>
<p><em><strong>}</strong></em></p>
<hr />
<p>&nbsp;</p>
<p>RGB画像、Depth画像両方が必要なので、双方のtexをpublicに直すことをお忘れなく。</p>
<p>最後にスクリーンになるオブジェクトに、</p>
<p><strong>DisplayDepth.cs</strong></p>
<p><strong>DisplayColor.cs</strong></p>
<p><strong>MaskScript.cs</strong></p>
<p><strong>Maskmat</strong></p>
<p>をすべてアタッチします。MaskScript.csのMatの部分には下にあるMaskmatをアサインしてください。</p>
<p><a href="files/2015/02/kinect3.jpg"><img class="alignnone size-medium wp-image-289" src="files/2015/02/kinect3-183x300.jpg" alt="kinect3" width="183" height="300" srcset="files/2015/02/kinect3-183x300.jpg 183w, files/2015/02/kinect3.jpg 600w" sizes="(max-width: 183px) 100vw, 183px" /></a></p>
<p>&nbsp;</p>
<p>そして、Maskmat上にあるBackの項目に背景にしたい画像を用意して格納し、実行すると人物画像だけ切り取ることができます。</p>
<p><a href="files/2015/02/kinect2.jpg"><img class="alignnone size-medium wp-image-288" src="files/2015/02/kinect2-256x300.jpg" alt="kinect2" width="256" height="300" srcset="files/2015/02/kinect2-256x300.jpg 256w, files/2015/02/kinect2-874x1024.jpg 874w, files/2015/02/kinect2.jpg 952w" sizes="(max-width: 256px) 100vw, 256px" /></a></p>
<p>&nbsp;</p>
<p>kinectのRGBカメラとDepthカメラの位置関係から少しずれが出ていますが、スクリプトで修正することはできると思います。</p>
<p><a href="https://twitter.com/share" class="twitter-share-button">Tweet</a> </p>
			</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="cat-links">カテゴリー: <a href="category/kinect/index.html" rel="category tag">Kinect</a>・<a href="category/unity/index.html" rel="category tag">Unity</a>・<a href="http://blog.shirai.la/tsuda/category/%e5%ad%a6%e8%a1%93%e9%96%a2%e4%bf%82/" rel="category tag">学術関係</a></span><span class="tags-links">タグ:  <a href="tag/kinect/index.html" rel="tag">Kinect</a>・<a href="tag/unity/index.html" rel="tag">Unity</a>・<a href="http://blog.shirai.la/tsuda/tag/%e3%83%9e%e3%82%b9%e3%82%af/" rel="tag">マスク</a></span><span class="permalink-bookmark"><a href="index.html@p=286.html" rel="bookmark">パーマリンクをブックマークする</a></span>
			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

			
				<nav class="navigation post-navigation" role="navigation">
		<h1 class="screen-reader-text">投稿ナビゲーション</h1>
		<div class="nav-links">
			<div class="nav-previous"><a href="index.html@p=284.html" rel="prev"><span class="meta-nav"></span> Lavalvirtual</a></div><div class="nav-next"><a href="http://blog.shirai.la/tsuda/2015/02/08/choregraphe%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6pepper%e9%96%8b%e7%99%ba%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b-%e9%96%8b%e7%99%ba%e7%92%b0%e5%a2%83%e6%a7%8b%e7%af%89%e7%b7%a8/" rel="next">choregrapheを使ってPepper開発してみる-開発環境構築編 <span class="meta-nav"></span></a></div>		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
		
		</main><!-- #main -->
	</div><!-- #primary -->


	</div><!-- #content -->
				<div id="secondary" class="widget-areas" role="complementary">
		<div class="widget-areas-inner">
							<div class="widget-area">
					<aside id="tag_cloud-3" class="widget widget_tag_cloud"><h1 class="widget-title">Category Cloud</h1><div class="tagcloud"><a href="category/arduino/index.html" class="tag-cloud-link tag-link-17 tag-link-position-1" style="font-size: 8pt;" aria-label="Arduino (1個の項目)">Arduino</a>
<a href="category/choregraphe/index.html" class="tag-cloud-link tag-link-23 tag-link-position-2" style="font-size: 14.588235294118pt;" aria-label="choregraphe (4個の項目)">choregraphe</a>
<a href="category/ec2015/index.html" class="tag-cloud-link tag-link-98 tag-link-position-3" style="font-size: 8pt;" aria-label="EC2015 (1個の項目)">EC2015</a>
<a href="category/faq/index.html" class="tag-cloud-link tag-link-121 tag-link-position-4" style="font-size: 8pt;" aria-label="FAQ (1個の項目)">FAQ</a>
<a href="category/ggj/index.html" class="tag-cloud-link tag-link-132 tag-link-position-5" style="font-size: 8pt;" aria-label="GGJ (1個の項目)">GGJ</a>
<a href="category/ggj15/index.html" class="tag-cloud-link tag-link-19 tag-link-position-6" style="font-size: 10.964705882353pt;" aria-label="GGJ15 (2個の項目)">GGJ15</a>
<a href="category/git/index.html" class="tag-cloud-link tag-link-74 tag-link-position-7" style="font-size: 8pt;" aria-label="Git (1個の項目)">Git</a>
<a href="category/ivrc/index.html" class="tag-cloud-link tag-link-11 tag-link-position-8" style="font-size: 8pt;" aria-label="IVRC (1個の項目)">IVRC</a>
<a href="category/kinect/index.html" class="tag-cloud-link tag-link-21 tag-link-position-9" style="font-size: 10.964705882353pt;" aria-label="Kinect (2個の項目)">Kinect</a>
<a href="category/lavalvirtual/index.html" class="tag-cloud-link tag-link-20 tag-link-position-10" style="font-size: 10.964705882353pt;" aria-label="Lavalvirtual (2個の項目)">Lavalvirtual</a>
<a href="category/nao/index.html" class="tag-cloud-link tag-link-26 tag-link-position-11" style="font-size: 14.588235294118pt;" aria-label="NAO (4個の項目)">NAO</a>
<a href="category/pepper/index.html" class="tag-cloud-link tag-link-24 tag-link-position-12" style="font-size: 14.588235294118pt;" aria-label="Pepper (4個の項目)">Pepper</a>
<a href="category/realsense/index.html" class="tag-cloud-link tag-link-22 tag-link-position-13" style="font-size: 8pt;" aria-label="Realsense (1個の項目)">Realsense</a>
<a href="category/tepia/index.html" class="tag-cloud-link tag-link-28 tag-link-position-14" style="font-size: 8pt;" aria-label="TEPIA (1個の項目)">TEPIA</a>
<a href="category/unity/index.html" class="tag-cloud-link tag-link-18 tag-link-position-15" style="font-size: 17.882352941176pt;" aria-label="Unity (7個の項目)">Unity</a>
<a href="category/vrsj2015/index.html" class="tag-cloud-link tag-link-97 tag-link-position-16" style="font-size: 8pt;" aria-label="VRSJ2015 (1個の項目)">VRSJ2015</a>
<a href="category/vscode/index.html" class="tag-cloud-link tag-link-73 tag-link-position-17" style="font-size: 14.588235294118pt;" aria-label="VSCode (4個の項目)">VSCode</a>
<a href="http://blog.shirai.la/tsuda/category/%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e3%83%ac%e3%83%9d%e3%83%bc%e3%83%88/" class="tag-cloud-link tag-link-9 tag-link-position-18" style="font-size: 20.188235294118pt;" aria-label="イベントレポート (10個の項目)">イベントレポート</a>
<a href="http://blog.shirai.la/tsuda/category/%e3%82%a4%e3%83%b3%e3%82%bf%e3%83%a9%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b32015/" class="tag-cloud-link tag-link-29 tag-link-position-19" style="font-size: 8pt;" aria-label="インタラクション2015 (1個の項目)">インタラクション2015</a>
<a href="http://blog.shirai.la/tsuda/category/%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b8%e3%83%a3%e3%83%a0/" class="tag-cloud-link tag-link-88 tag-link-position-20" style="font-size: 14.588235294118pt;" aria-label="ゲームジャム (4個の項目)">ゲームジャム</a>
<a href="http://blog.shirai.la/tsuda/category/%e3%83%80%e3%82%a4%e3%82%a8%e3%83%83%e3%83%88/" class="tag-cloud-link tag-link-12 tag-link-position-21" style="font-size: 10.964705882353pt;" aria-label="ダイエット (2個の項目)">ダイエット</a>
<a href="http://blog.shirai.la/tsuda/category/%e3%83%8b%e3%82%b3%e3%83%8b%e3%82%b3%e8%b6%85%e4%bc%9a%e8%ad%b0/" class="tag-cloud-link tag-link-30 tag-link-position-22" style="font-size: 8pt;" aria-label="ニコニコ超会議 (1個の項目)">ニコニコ超会議</a>
<a href="http://blog.shirai.la/tsuda/category/%e3%83%a9%e3%82%a4%e3%83%95%e3%83%8f%e3%83%83%e3%82%af/" class="tag-cloud-link tag-link-141 tag-link-position-23" style="font-size: 8pt;" aria-label="ライフハック (1個の項目)">ライフハック</a>
<a href="http://blog.shirai.la/tsuda/category/%e5%86%99%e7%9c%9f/" class="tag-cloud-link tag-link-16 tag-link-position-24" style="font-size: 8pt;" aria-label="写真 (1個の項目)">写真</a>
<a href="http://blog.shirai.la/tsuda/category/%e5%8f%97%e8%b3%9e/" class="tag-cloud-link tag-link-112 tag-link-position-25" style="font-size: 8pt;" aria-label="受賞 (1個の項目)">受賞</a>
<a href="http://blog.shirai.la/tsuda/category/%e5%ad%a6%e4%bc%9a%e7%99%ba%e8%a1%a8/" class="tag-cloud-link tag-link-96 tag-link-position-26" style="font-size: 8pt;" aria-label="学会発表 (1個の項目)">学会発表</a>
<a href="http://blog.shirai.la/tsuda/category/%e5%ad%a6%e8%a1%93%e9%96%a2%e4%bf%82/" class="tag-cloud-link tag-link-3 tag-link-position-27" style="font-size: 18.705882352941pt;" aria-label="学術関係 (8個の項目)">学術関係</a>
<a href="http://blog.shirai.la/tsuda/category/%e5%b0%b1%e6%b4%bb/" class="tag-cloud-link tag-link-104 tag-link-position-28" style="font-size: 10.964705882353pt;" aria-label="就活 (2個の項目)">就活</a>
<a href="http://blog.shirai.la/tsuda/category/%e5%bf%98%e5%82%99%e9%8c%b2/" class="tag-cloud-link tag-link-27 tag-link-position-29" style="font-size: 22pt;" aria-label="忘備録 (13個の項目)">忘備録</a>
<a href="http://blog.shirai.la/tsuda/category/%e6%97%85%e8%a1%8c/" class="tag-cloud-link tag-link-14 tag-link-position-30" style="font-size: 10.964705882353pt;" aria-label="旅行 (2個の項目)">旅行</a>
<a href="http://blog.shirai.la/tsuda/category/%e6%97%a5%e5%b8%b8/" class="tag-cloud-link tag-link-2 tag-link-position-31" style="font-size: 20.188235294118pt;" aria-label="日常 (10個の項目)">日常</a>
<a href="http://blog.shirai.la/tsuda/category/%e6%9b%b8%e3%81%8d%e7%89%a9/" class="tag-cloud-link tag-link-120 tag-link-position-32" style="font-size: 10.964705882353pt;" aria-label="書き物 (2個の項目)">書き物</a>
<a href="http://blog.shirai.la/tsuda/category/%e6%9c%aa%e5%88%86%e9%a1%9e/" class="tag-cloud-link tag-link-1 tag-link-position-33" style="font-size: 12.941176470588pt;" aria-label="未分類 (3個の項目)">未分類</a>
<a href="http://blog.shirai.la/tsuda/category/%e7%99%bd%e4%ba%95%e3%82%bb%e3%83%9f%e3%83%8a%e3%83%bc14/" class="tag-cloud-link tag-link-10 tag-link-position-34" style="font-size: 10.964705882353pt;" aria-label="白井セミナー&#039;14 (2個の項目)">白井セミナー&#039;14</a>
<a href="http://blog.shirai.la/tsuda/category/%e7%99%bd%e4%ba%95%e7%a0%94%e7%a9%b6%e5%ae%a4/" class="tag-cloud-link tag-link-25 tag-link-position-35" style="font-size: 20.847058823529pt;" aria-label="白井研究室 (11個の項目)">白井研究室</a>
<a href="http://blog.shirai.la/tsuda/category/%e7%ac%91%e9%a1%94%e8%aa%8d%e8%ad%98/" class="tag-cloud-link tag-link-99 tag-link-position-36" style="font-size: 8pt;" aria-label="笑顔認識 (1個の項目)">笑顔認識</a>
<a href="http://blog.shirai.la/tsuda/category/%e9%99%b6%e8%8a%b8/" class="tag-cloud-link tag-link-8 tag-link-position-37" style="font-size: 8pt;" aria-label="陶芸 (1個の項目)">陶芸</a>
<a href="http://blog.shirai.la/tsuda/category/%e9%9b%91%e8%a8%98/" class="tag-cloud-link tag-link-145 tag-link-position-38" style="font-size: 10.964705882353pt;" aria-label="雑記 (2個の項目)">雑記</a>
<a href="http://blog.shirai.la/tsuda/category/%e9%a3%9f%e3%81%b9%e7%89%a9/" class="tag-cloud-link tag-link-15 tag-link-position-39" style="font-size: 12.941176470588pt;" aria-label="食べ物 (3個の項目)">食べ物</a></div>
</aside>				</div>
										<div class="widget-area">
									</div>
										<div class="widget-area">
									</div>
										<div class="widget-area">
					<aside id="media_image-5" class="widget widget_media_image"><h1 class="widget-title">Laboratory</h1><a href="../index.html" target="_blank"><img width="143" height="59" src="files/2016/01/shiraiLab.png" class="image wp-image-869 aligncenter attachment-full size-full" alt="" style="max-width: 100%; height: auto;" /></a></aside>				</div>
					</div>
	</div><!-- #secondary -->
		<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="site-info">
			<a href="https://ja.wordpress.org/">Proudly powered by WordPress</a>
			<span class="sep"> &bull; </span>
			Theme: Pictorico by <a href="http://wordpress.com/themes/pictorico/" rel="designer">WordPress.com</a>.		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"http:\/\/blog.shirai.la\/tsuda\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"}};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content/plugins/contact-form-7/includes/js/scripts.js@ver=5.1.9'></script>
<script type='text/javascript' src='wp-content/themes/pictorico/js/navigation.js@ver=20120206'></script>
<script type='text/javascript' src='wp-content/themes/pictorico/js/skip-link-focus-fix.js@ver=20130115'></script>
<script type='text/javascript' src='wp-includes/js/wp-embed.min.js@ver=5.1.6'></script>

</body>
</html>
